package com.unionpay.support.controller;

import com.unionpay.services.util.ResultList;
import com.unionpay.support.model.ServerDateTime;
import com.unionpay.support.pojo.SupportTimeNum;
import com.unionpay.support.service.SupportInfoService;
import com.unionpay.support.service.SupportTimeNumService;
import io.swagger.annotations.Api;
import io.swagger.annotations.ApiOperation;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.*;

import java.util.ArrayList;
import java.util.List;

/**
 * @Author: jinzhao
 * @Date: 2019/10/25 09:31
 * @Description:
 */

@RestController
@RequestMapping("/supportTimeNum")
@Api(value = "/supportTimeNum",tags = "办公支持服务之约定预约时间段次数",description = "办公支持服务之约定预约时间段次数")
public class SupportTimeNumController {

    @Autowired
    private SupportInfoService supportInfoService;
    @Autowired
    private SupportTimeNumService supportTimeNumService;


    @ApiOperation(value = "查询发起预约时不同地点下的时间段",notes = "查询发起预约时不同地点下的时间段")
    @PostMapping("/getTime")
    @ResponseBody
    public ResultList getTime(@RequestParam String myPlace, @RequestParam String dateTime){
        ResultList resultList = new ResultList();
        List<String> arrayList = new ArrayList<>();
        //根据地名查询该地名下所约定的服务时间段和可服务次数
        List<SupportTimeNum> list = supportTimeNumService.selectByPlaceNameAndExceptedTime(myPlace);
        for (int i = 0; i < list.size(); i++) {
            String exceptedTime = list.get(i).getExceptedTime();
            Integer num = list.get(i).getExceptedNum();
            //根据地名，日期和时间段查询该条件下已服务次数
            ServerDateTime serverDateTime = supportInfoService.selectByMyplaceAndDatetimme(myPlace,exceptedTime,dateTime);
                Integer count = serverDateTime.getCount();
                //比较次数，已服务次数小于约定次数则添加到list返回给前端
                if (count < num ){
                    arrayList.add(exceptedTime);
            }

        }

//        arrayList.add(myPlace);
//        arrayList.add(dateTime);
        resultList.setCode(200);
        resultList.setMessage("查询成功");
        resultList.setData(arrayList);
        return resultList;
    }
}
